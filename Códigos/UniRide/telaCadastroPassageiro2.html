<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

</head>

<body>
    <main class="container">
        <section class="login-box">

            <div class="btn-voltar">
                <a href="telaCadastroPassageiro.html" class="ri-arrow-left-line"></a>
            </div>

            <div class="box-titulo">

                <h1 class="titulo">Informações de cadastro</h1>

            </div>
            <form class="upload-container form-login">
                <h2>Endereço</h2>
                <label>Rua</label>
                <input type="text" class="maiusculo">

                <label>Número</label>
                <input type="text">

                <label>Complemento (opcional)</label>
                <input type="text" class="maiusculo">
            </form>
            <form class="upload-container form-login">
                <h2>Dados do cartão</h2>
                <label>Número do cartao</label>
                <input type="text" placeholder="0000 0000 0000 0000">

                <label>Validade</label>
                <input type="text" placeholder="MM/AA">

                <label>Código de segurança</label>
                <input type="text" placeholder="CVV">

                <label>Nome do titular</label>
                <input type="text" class="maiusculo">

            </form>
            <div class="btn-group">
                <a href="telaLogin.html" id="openPopupPular" class="btns upload">Pular</a>
                <a href="telaLogin.html" id="btnFinalizarCadastro" class="btns upload">Finalizar</a>
            </div>

            <div id="popup" class="popup">
                <div class="popup-content">
                    <h2>Gostaria de se cadastrar como motorista?</h2>

                    <div class="btn-group">
                        <a id="closePopup" class="btns upload">Não</a>
                        <a href="telaCadastroMotorista.html" class="btns upload">Sim</a>
                    </div>
                </div>
            </div>

            <div id="popupPular" class="popup">
                <div class="popup-content">
                    <h2>Cadastro finalizado.</h2>
                    <h3>Você será redirecionado a tela de login.</h3>
                    <br>

                    <div class="btn-group">
                        <a href="telaLogin.html" id="closePopupPular" class="btns upload">Ok</a>

                    </div>
                </div>
            </div>

            <script>
                // Abrir popup principal
                document.getElementById("openPopup").onclick = function (e) {
                    e.preventDefault();
                    document.getElementById("popup").style.display = "flex";
                }

                // Abrir popup Pular
                document.getElementById("openPopupPular").onclick = function (e) {
                    e.preventDefault();
                    document.getElementById("popupPular").style.display = "flex";
                }

                // Botão "Não" → fechar popup principal e abrir popupPular
                document.getElementById("closePopup").onclick = function () {
                    document.getElementById("popup").style.display = "none";       // fecha popup
                    document.getElementById("popupPular").style.display = "flex";  // abre popupPular
                }

                // Botão OK do popupPular
                document.getElementById("closePopupPular").onclick = function () {
                    document.getElementById("popupPular").style.display = "none";
                }
            </script>


        </section>
    </main>

<script type="module">

import { db, auth } from "./js/firebase.js";
import { doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

async function salvarPasso2() {
    const uid = auth.currentUser?.uid;
    if (!uid) {
        alert("Usuário não autenticado. Faça login.");
        return;
    }

    const rua = document.querySelector("input[placeholder='Rua']").value || "";
    const numero = document.querySelector("input[placeholder='Número']").value || "";
    const complemento = document.querySelector("input[placeholder='Complemento (opcional)']").value || "";

    const numeroCartao = document.querySelector("input[placeholder='0000 0000 0000 0000']").value || "";
    const validade = document.querySelector("input[placeholder='MM/AA']").value || "";
    const cvv = document.querySelector("input[placeholder='CVV']").value || "";
    const nomeTitular = document.querySelector("input[placeholder='Nome do titular']").value || "";

    try {
        await updateDoc(doc(db, "passageiros", uid), {
            endereco: { rua, numero, complemento },
            cartao: { numero: numeroCartao, validade, cvv, nomeTitular },
            updatedAt: new Date().toISOString()
        });
        // open existing popup
        document.getElementById("popupPular")?.style.display = "flex";
    } catch (err) {
        console.error(err);
        alert("Erro ao salvar: " + (err.message || err));
    }
}

document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btnFinalizarCadastro");
    if (btn) btn.addEventListener("click", (e) => { e.preventDefault(); salvarPasso2(); });

    // keep existing popup handlers if present
});

</script>
</body>

</html>